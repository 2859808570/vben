# 需求列表设计文档

## 1. 功能概述

需求列表是软件项目管理系统中的核心功能模块，用于展示、查询、筛选和管理系统中的所有需求。该模块提供了丰富的筛选、排序和分页功能，帮助用户快速定位和管理需求。

### 1.1 功能目标
- 提供需求信息的集中展示和管理
- 支持多维度筛选和搜索
- 支持表格排序和分页
- 提供快速操作入口（创建、查看、编辑、删除）

### 1.2 用户角色
- 需求提交人
- 需求评审人
- 项目负责人
- 软件工程师
- 测试人员
- 软件团队管理人员

## 2. 页面结构

### 2.1 整体布局
```
┌─────────────────────────────────────────┐
│  需求列表                    [创建需求]  │
├─────────────────────────────────────────┤
│  搜索表单区域                            │
│  [需求名称] [需求类型] [需求状态] [查询] │
├─────────────────────────────────────────┤
│  表格区域                                │
│  ┌──────────────────────────────────┐  │
│  │ 序号 │ 需求名称 │ 类型 │ 状态... │  │
│  ├──────────────────────────────────┤  │
│  │  1   │  xxx    │  xxx │  xxx   │  │
│  │  2   │  xxx    │  xxx │  xxx   │  │
│  └──────────────────────────────────┘  │
├─────────────────────────────────────────┤
│  分页组件                                │
└─────────────────────────────────────────┘
```

### 2.2 组件层次结构
```
requirement-list (页面容器)
└── el-card (卡片容器)
    ├── header (卡片头部)
    │   ├── 标题
    │   └── 创建需求按钮
    ├── el-form (搜索表单)
    │   ├── 需求名称输入框
    │   ├── 需求类型下拉选择
    │   ├── 需求状态下拉选择
    │   ├── 查询按钮
    │   └── 重置按钮
    ├── el-table (数据表格)
    │   ├── 序号列
    │   ├── 需求名称列（支持筛选）
    │   ├── 需求类型列（支持筛选、排序）
    │   ├── 需求状态列（支持筛选、排序）
    │   ├── 优先级列（支持筛选、排序）
    │   ├── 进展列（支持排序）
    │   ├── 需求负责人列（支持筛选）
    │   ├── 开发负责人列（支持筛选）
    │   ├── 预计结束时间列（支持筛选、排序）
    │   └── 操作列
    └── el-pagination (分页组件)
```

## 3. 功能特性

### 3.1 搜索功能

#### 3.1.1 搜索表单
- **需求名称**：文本输入框，支持模糊搜索
- **需求类型**：多选下拉框，支持选择多个类型
- **需求状态**：多选下拉框，支持选择多个状态
- **查询按钮**：执行搜索，重置页码为第一页
- **重置按钮**：清空所有搜索条件，恢复默认状态

#### 3.1.2 表头筛选
每个支持筛选的列都提供表头筛选功能：

**需求名称筛选**
- 点击表头筛选图标，弹出输入框
- 支持输入关键字进行筛选
- 支持回车键快速确认

**需求类型/状态/优先级筛选**
- 点击表头筛选图标，弹出筛选面板
- 支持搜索框快速定位选项
- 支持全选/取消全选
- 显示每个选项的数据统计数量
- 支持多选，选项少于6个时单列显示，6个及以上时双列显示

**需求负责人/开发负责人筛选**
- 点击表头筛选图标，弹出筛选面板
- 支持搜索框快速定位负责人
- 支持全选/取消全选
- 显示每个负责人的数据统计数量
- 自动从数据中提取唯一的负责人列表

**预计结束时间筛选**
- 点击表头筛选图标，弹出树形筛选面板
- 按年份-月份-日期三级结构组织
- 支持搜索框过滤日期
- 支持多选日期
- 显示每个日期节点的数据统计数量

### 3.2 排序功能

支持以下列的排序：
- **需求名称**：字符串排序
- **需求类型**：按预定义顺序排序（新增需求、功能优化、BUG修复、效率提升、UI调整）
- **需求状态**：按状态流转顺序排序（待评审、评审中、已通过、已排期、开发中、测试中、已上线、已验收、已关闭、已取消）
- **优先级**：按优先级高低排序（紧急、高、中、低）
- **进展**：按数值大小排序
- **预计结束时间**：按日期先后排序

### 3.3 分页功能

- 支持每页显示数量选择：10、20、50、100
- 支持页码跳转
- 显示总记录数
- 分页信息：总数、每页数量、当前页码

### 3.4 操作功能

每行数据提供以下操作：
- **详情**：跳转到需求详情页面
- **编辑**：跳转到需求编辑页面（带编辑参数）
- **删除**：删除需求（需确认）

### 3.5 数据展示

#### 3.5.1 表格列说明
| 列名 | 说明 | 类型 | 筛选 | 排序 |
|------|------|------|------|------|
| 序号 | 自动编号，考虑分页 | 数字 | ❌ | ❌ |
| 需求名称 | 需求的名称 | 文本 | ✅ | ✅ |
| 需求类型 | 需求的类型 | 标签 | ✅ | ✅ |
| 需求状态 | 需求的当前状态 | 标签 | ✅ | ✅ |
| 优先级 | 需求的优先级 | 标签 | ✅ | ✅ |
| 进展 | 需求完成进度百分比 | 进度条 | ❌ | ✅ |
| 需求负责人 | 负责该需求的人员 | 文本 | ✅ | ✅ |
| 开发负责人 | 负责开发的人员 | 文本 | ✅ | ✅ |
| 预计结束时间 | 预计完成时间 | 日期 | ✅ | ✅ |
| 操作 | 操作按钮 | 按钮组 | ❌ | ❌ |

#### 3.5.2 标签颜色方案
- **需求类型标签**：
  - 新增需求：primary
  - 功能优化：success
  - BUG修复：danger
  - 效率提升：warning
  - UI调整：info

- **需求状态标签**：
  - 待评审：info
  - 评审中：warning
  - 已通过：success
  - 已排期：primary
  - 开发中：primary
  - 测试中：warning
  - 已上线：success
  - 已验收：success
  - 已关闭：info
  - 已取消：danger

- **优先级标签**：
  - 紧急：danger
  - 高：warning
  - 中：primary
  - 低：info

## 4. 数据模型

### 4.1 Requirement 实体

```typescript
interface Requirement {
  requirementId: string                    // 需求ID
  parentRequirementId?: string            // 父需求ID
  productId?: string                      // 产品ID
  projectId?: string                      // 项目ID
  moduleId?: string                       // 模块ID
  functionId?: string                     // 功能ID
  requirementName: string                 // 需求名称
  requirementDescription?: string         // 需求描述
  requirementType: RequirementType        // 需求类型
  requirementStatus: RequirementStatus    // 需求状态
  requirementPriority: Priority          // 优先级
  requirementProgress: number             // 进展百分比 0-100
  requirementIsCompleted: boolean         // 是否已完成
  requirementOwner?: string               // 需求负责人
  developmentOwner?: string               // 开发负责人
  testOwner?: string                     // 测试负责人
  requirementStartTime?: string          // 开始时间
  requirementExpectedEndTime?: string    // 预计结束时间
  requirementActualEndTime?: string      // 实际结束时间
  createTime?: string                     // 创建时间
  updateTime?: string                     // 更新时间
}
```

### 4.2 RequirementQueryParams 查询参数

```typescript
interface RequirementQueryParams {
  requirementName?: string                // 需求名称（模糊搜索）
  requirementType?: RequirementType | RequirementType[]  // 需求类型（支持多选）
  requirementStatus?: RequirementStatus | RequirementStatus[]  // 需求状态（支持多选）
  requirementPriority?: Priority         // 优先级
  productId?: string                     // 产品ID
  projectId?: string                     // 项目ID
  moduleId?: string                      // 模块ID
  requirementOwner?: string              // 需求负责人
  developmentOwner?: string              // 开发负责人
  startTime?: string                     // 开始时间范围
  endTime?: string                       // 结束时间范围
  page: number                           // 页码
  pageSize: number                       // 每页数量
}
```

### 4.3 枚举类型

```typescript
// 需求类型
enum RequirementType {
  NEW = '新增需求',
  OPTIMIZATION = '功能优化',
  BUG_FIX = 'BUG修复',
  EFFICIENCY = '效率提升',
  UI_ADJUST = 'UI调整'
}

// 需求状态
enum RequirementStatus {
  PENDING_REVIEW = '待评审',
  REVIEWING = '评审中',
  APPROVED = '已通过',
  SCHEDULED = '已排期',
  DEVELOPING = '开发中',
  TESTING = '测试中',
  ONLINE = '已上线',
  ACCEPTED = '已验收',
  CLOSED = '已关闭',
  CANCELLED = '已取消'
}

// 优先级
enum Priority {
  URGENT = '紧急',
  HIGH = '高',
  MEDIUM = '中',
  LOW = '低'
}
```

## 5. API接口设计

### 5.1 获取需求列表

**接口地址**：`GET /requirement/list`

**请求参数**：
```typescript
{
  requirementName?: string
  requirementType?: RequirementType | RequirementType[]
  requirementStatus?: RequirementStatus | RequirementStatus[]
  requirementPriority?: Priority
  productId?: string
  projectId?: string
  moduleId?: string
  requirementOwner?: string
  developmentOwner?: string
  startTime?: string
  endTime?: string
  page: number
  pageSize: number
}
```

**响应数据**：
```typescript
{
  code: number
  message: string
  data: {
    list: Requirement[]
    total: number
    page: number
    pageSize: number
  }
}
```

### 5.2 删除需求

**接口地址**：`DELETE /requirement/:id`

**请求参数**：无

**响应数据**：
```typescript
{
  code: number
  message: string
  data: null
}
```

## 6. 前端实现细节

### 6.1 技术栈
- **框架**：Vue 3 (Composition API)
- **UI组件库**：Element Plus
- **路由**：Vue Router 4
- **类型系统**：TypeScript

### 6.2 核心功能实现

#### 6.2.1 数据加载
```typescript
// 加载数据
function loadData() {
  loading.value = true
  
  // 调用API获取数据
  getRequirementList(queryParams)
    .then(res => {
      allData.value = res.data.list
      total.value = res.data.total
    })
    .finally(() => {
      loading.value = false
    })
}
```

#### 6.2.2 数据筛选
筛选逻辑支持多维度组合筛选：
1. 搜索表单筛选（需求名称、需求类型、需求状态）
2. 表头筛选（各列独立筛选）
3. 筛选条件可叠加，取交集

```typescript
// 过滤数据
function filterData() {
  let filtered = [...allData.value]
  
  // 按需求名称过滤
  if (queryParams.requirementName) {
    filtered = filtered.filter(item =>
      item.requirementName.includes(queryParams.requirementName)
    )
  }
  
  // 按需求类型过滤
  if (queryParams.requirementType?.length > 0) {
    const typeSet = new Set(queryParams.requirementType)
    filtered = filtered.filter(item => typeSet.has(item.requirementType))
  }
  
  // 按需求状态过滤
  if (queryParams.requirementStatus?.length > 0) {
    const statusSet = new Set(queryParams.requirementStatus)
    filtered = filtered.filter(item => statusSet.has(item.requirementStatus))
  }
  
  // 表头筛选条件...
  
  return filtered
}
```

#### 6.2.3 分页处理
```typescript
// 经过筛选和分页后的表格数据
const filteredTableData = computed(() => {
  const allFiltered = filterData()
  const start = (queryParams.page - 1) * queryParams.pageSize
  const end = start + queryParams.pageSize
  return allFiltered.slice(start, end)
})
```

#### 6.2.4 统计数量计算
表头筛选面板中显示每个选项的数据统计数量，统计基于当前其他筛选条件（排除当前列的筛选）：

```typescript
// 统计每个需求类型出现的次数
const requirementTypeCounts = computed(() => {
  const counts: Record<string, number> = {}
  const filtered = filterDataExcludingColumn('requirementType')
  filtered.forEach(item => {
    const type = item.requirementType
    counts[type] = (counts[type] || 0) + 1
  })
  return counts
})
```

#### 6.2.5 日期树形结构
预计结束时间筛选使用树形结构，按年份-月份-日期三级组织：

```typescript
// 创建日期树形结构
const dateTreeData = computed<DateTreeNode[]>(() => {
  const dates = allDates.value
  const counts = dateCounts.value
  
  // 按年份和月份组织数据
  const yearMap = new Map<string, Map<string, string[]>>()
  
  // 构建树形结构
  // 年份 -> 月份 -> 日期
  // ...
  
  return tree
})
```

### 6.3 状态管理

#### 6.3.1 响应式状态
- `loading`: 加载状态
- `allData`: 所有需求数据
- `total`: 总记录数
- `queryParams`: 查询参数
- 各列的筛选状态（visible、selected、search等）

#### 6.3.2 计算属性
- `filteredTableData`: 经过筛选和分页后的表格数据
- `requirementTypeCounts`: 需求类型统计
- `requirementStatusCounts`: 需求状态统计
- `priorityCounts`: 优先级统计
- `requirementOwnerCounts`: 需求负责人统计
- `developmentOwnerCounts`: 开发负责人统计
- `dateCounts`: 日期统计
- `dateTreeData`: 日期树形数据

### 6.4 交互设计

#### 6.4.1 筛选图标状态
- 默认状态：灰色图标
- 有筛选条件时：蓝色图标（高亮显示）

#### 6.4.2 筛选面板交互
- 点击表头筛选图标，弹出筛选面板
- 面板内支持搜索、全选、多选
- 点击"确定"应用筛选，点击"重置"清空筛选
- 筛选条件与搜索表单同步

#### 6.4.3 排序交互
- 点击列标题进行排序
- 支持升序/降序切换
- 排序图标显示当前排序状态

#### 6.4.4 分页交互
- 修改每页数量时自动重新加载数据
- 切换页码时保持当前筛选条件

## 7. 样式设计

### 7.1 布局样式
- 使用 `el-card` 作为容器，提供卡片式布局
- 表格区域自适应高度，支持滚动
- 分页组件固定在底部

### 7.2 筛选面板样式
- 筛选面板宽度根据内容自适应（240px-320px）
- 选项列表支持滚动（最大高度220px-300px）
- 选项少于6个时单列显示，6个及以上时双列显示
- 显示统计数量的文字样式为灰色小字

### 7.3 表格样式
- 表头支持筛选图标和排序图标共存
- 操作列固定在右侧
- 标签颜色根据类型/状态/优先级显示不同颜色

## 8. 性能优化

### 8.1 数据加载优化
- 使用分页加载，避免一次性加载大量数据
- 支持加载状态提示

### 8.2 筛选性能优化
- 使用计算属性缓存筛选结果
- 统计数量计算时排除当前列的筛选条件，避免重复计算

### 8.3 渲染优化
- 使用虚拟滚动（如果数据量大）
- 表格列使用 `min-width` 而非固定宽度，提高响应式表现

## 9. 错误处理

### 9.1 API错误处理
- 网络错误：显示错误提示
- 业务错误：显示后端返回的错误信息
- 加载失败：提供重试机制

### 9.2 数据验证
- 查询参数验证
- 分页参数边界检查
- 日期格式验证

## 10. 扩展性考虑

### 10.1 功能扩展
- 支持导出功能（导出Excel）
- 支持批量操作（批量删除、批量修改状态等）
- 支持列显示/隐藏配置
- 支持自定义排序规则保存

### 10.2 性能扩展
- 支持服务端分页和筛选
- 支持数据缓存
- 支持懒加载

## 11. 测试要点

### 11.1 功能测试
- 搜索功能测试
- 筛选功能测试（各列筛选）
- 排序功能测试
- 分页功能测试
- 操作功能测试（创建、查看、编辑、删除）

### 11.2 边界测试
- 空数据展示
- 大数据量性能测试
- 筛选条件组合测试
- 分页边界测试

### 11.3 兼容性测试
- 不同浏览器兼容性
- 不同屏幕尺寸响应式测试

## 12. 文件结构

```
src/views/requirement/list/
├── index.vue              # 需求列表页面主文件
└── (样式文件内联在组件中)

src/api/
└── requirement.ts          # 需求相关API

src/types/
├── index.ts                # 基础类型定义
└── requirement.ts          # 需求相关类型定义

src/utils/
├── status.ts                # 状态相关工具函数
└── date.ts                  # 日期格式化工具函数
```

## 13. 开发注意事项

1. **类型安全**：严格使用TypeScript类型定义，避免使用 `any`
2. **响应式数据**：合理使用 `ref`、`reactive`、`computed`
3. **性能优化**：避免不必要的重复计算，使用计算属性缓存
4. **用户体验**：提供加载状态、错误提示、操作确认等
5. **代码规范**：遵循项目代码规范，保持代码可读性
6. **筛选同步**：确保表头筛选与搜索表单筛选状态同步

## 14. 更新日志

### v1.0.0 (2024-01-XX)
- 初始版本
- 实现基础的需求列表展示
- 实现搜索、筛选、排序、分页功能
- 实现表头筛选功能
- 实现操作功能（创建、查看、编辑、删除）

